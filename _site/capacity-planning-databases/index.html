<!doctype html>
<!--[if lt IE 7]><html class="no-js lt-ie9 lt-ie8 lt-ie7" lang="en"> <![endif]-->
<!--[if (IE 7)&!(IEMobile)]><html class="no-js lt-ie9 lt-ie8" lang="en"><![endif]-->
<!--[if (IE 8)&!(IEMobile)]><html class="no-js lt-ie9" lang="en"><![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en"><!--<![endif]-->
<head>
<meta charset="utf-8">
<title>Capacity planning for databases &#8211; dbsmasher corner</title>
<meta name="description" content="Thoughts, stories and ideas">
<meta name="keywords" content="dba101, capacity, planning">

<!-- Twitter Cards -->
<meta name="twitter:card" content="summary">
<meta name="twitter:site" content="@dbsmasher">
<meta name="twitter:creator" content="@dbsmasher">

<!-- Open Graph -->
<meta property="og:locale" content="en_US">
<meta property="og:type" content="article">
<meta property="og:title" content="Capacity planning for databases">
<meta property="og:description" content="Thoughts, stories and ideas">
<meta property="og:url" content="http://localhost:4000/capacity-planning-databases/">
<meta property="og:site_name" content="dbsmasher corner">
<meta property="og:image" content="http://localhost:4000/images/images/logo.png">





<link rel="canonical" href="http://localhost:4000/capacity-planning-databases/">
<link href="http://localhost:4000/feed.xml" type="application/atom+xml" rel="alternate" title="dbsmasher corner Feed">

<!-- http://t.co/dKP3o1e -->
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1.0, user-scalable=no"/>

<!-- For all browsers -->
<link rel="stylesheet" href="http://localhost:4000/assets/css/main.css">
<link rel="stylesheet" href="http://localhost:4000/assets/css/jquery.mmenu.all.css">
<link rel="stylesheet" href="http://localhost:4000/assets/css/jquery.floating-social-share.min.css">
<!-- Webfonts -->
<link href="//fonts.googleapis.com/css?family=Lato:300,400,700,300italic,400italic" rel="stylesheet" type="text/css">

<meta http-equiv="cleartype" content="on">

<!-- Load Modernizr -->
<script type="text/javascript" src="http://localhost:4000/assets/js/vendor/modernizr-2.6.2.custom.min.js"></script>

<!-- Icons -->
<!-- 16x16 -->
<link rel="shortcut icon" href="http://localhost:4000/favicon.ico">
<!-- 32x32 -->
<link rel="shortcut icon" href="http://localhost:4000/favicon.png">
<!-- 57x57 (precomposed) for iPhone 3GS, pre-2011 iPod Touch and older Android devices -->
<link rel="apple-touch-icon-precomposed" href="http://localhost:4000/images/apple-touch-icon-precomposed.png">
<!-- 72x72 (precomposed) for 1st generation iPad, iPad 2 and iPad mini -->
<link rel="apple-touch-icon-precomposed" sizes="72x72" href="http://localhost:4000/images/apple-touch-icon-72x72-precomposed.png">
<!-- 114x114 (precomposed) for iPhone 4, 4S, 5 and post-2011 iPod Touch -->
<link rel="apple-touch-icon-precomposed" sizes="114x114" href="http://localhost:4000/images/apple-touch-icon-114x114-precomposed.png">
<!-- 144x144 (precomposed) for iPad 3rd and 4th generation -->
<link rel="apple-touch-icon-precomposed" sizes="144x144" href="http://localhost:4000/images/apple-touch-icon-144x144-precomposed.png">




</head>

<body id="post" >

<!--[if lt IE 9]><div class="upgrade"><strong><a href="http://whatbrowser.org/">Your browser is quite old!</strong> Why not upgrade to a different browser to better enjoy this site?</a></div><![endif]-->



<div class="header-menu header-menu-top">
    <ul class="header-item-container">
      <li class="header-item-title header-toggle "><a href="#menu"><h2><i class="fa fa-bars"></i></h2></a></li>
      <li class="header-item-title">
        <a href="http://localhost:4000/">
          
            <img class="logo" src="http://localhost:4000/images/logo.png" alt="dbsmasher corner">
          
          <a href="http://localhost:4000/" class="title"> dbsmasher corner</a>
        </a>
      </li>
      
        
        

        
            
                <li class="header-item "><a href="http://localhost:4000/tags"><h3>Tags</h3></a></li>
            
        
      
        
        

        
            
                <li class="header-item "><a href="http://localhost:4000/"><h3>Home</h3></a></li>
            
        
      
      <li class="header-item"><a href="http://localhost:4000/search"><h3><i class="fa fa-search"></i></h3></a></li>
    </ul>
  </div>
<div class="entry-header">
  <div class="header-title">
    <div class="header-title-wrap">
      <h1>Capacity planning for databases</h1>
      
        <h2><span class="entry-date date published updated"><time datetime="2016-03-25T03:17:11-07:00">March 25, 2016</time></span></h2>
      

      
          <p class="entry-reading-time">
            &nbsp;
          </p><!-- /.entry-reading-time -->
      
    </div><!-- /.header-title-wrap -->
  </div><!-- /.header-title -->
</div><!-- /.entry-header -->


<nav id="menu" style="display: none">
  <ul>
    
      
        <li><a href="http://localhost:4000/"><h3>Home</h3></a></li>
      
    
      
        <li><a href="http://localhost:4000/tags"><h3>Tags</h3></a></li>
      
    
  </ul>
</nav>


  <a href="https://twitter.com/dbsmasher" class="btn btn-info button-twitter" data-show-count="false" data-size="large"><i class="fa fa-twitter"></i> <span> | Follow @dbsmasher</span></a>



<div id="main" role="main">
  <article class="hentry hentry-dark">
    <div class="entry-content">
      
      <h1 class="post-title entry-title">Capacity planning for databases</h1>
      <p><em>Note:</em> This is inspired by Julia Evans‚Äô recent post about ‚Ä¶.<a href="http://jvns.ca/blog/2016/03/20/how-do-you-do-capacity-planning/">capacity planning</a> üòå</p>

<h3 id="ground-rules">Ground rules</h3>

<h4 id="rdbms">RDBMS</h4>
<p>Yes..this post is geared for those of us who use MySQL with a single writer at a time and 2 or more read replicas. A lot of what I will talk about here applies differently, or not at all, to multi writer clustered datastores, although those also come with their own set of compromises and caveats. So‚Ä¶your milage will definitely vary.</p>

<h4 id="sharding">Sharding</h4>

<p>I have already covered large strokes of this in one of my <a href="https://blog.dbsmasher.com/2015/02/08/scaling-mysql-at-sendgrid/">earlier posts</a>, I mostly focused there on the benefits of functional or horizontal sharding. Yes that is a prerequisite, since what you use to access the database layer WILL decide how much flexibility you have to scale.</p>

<p>If you are a company that experiences large differences between peak and average traffic, you should be prepared to leave the paradigm of ‚Äòthe database‚Äô as a single physical entity behind.</p>

<h4 id="ability-to-split-reads-and-writes">Ability to split reads and writes</h4>

<p>This is something you will need to be able to do, but not necessarily enforce as a set in stone rule. There will be use cases where a write needs to be read very soon after and where tolerance for things like lag/eventual consistency is low. Those are ok to have, but in the same applications, you will also have scenarios for reads that <em>can</em> tolerate some longer time span of eventual consistency. When such reads are in high volume, do you really want that volume going to your single writer if it doesn‚Äôt really have to? Do yourself a favor, and make sure soon in your growth days that you can control the use of a read or write IP in your code.</p>

<p>Now onto the thought process of actual capacity planning‚Ä¶</p>

<p><strong>A database cluster is not keeping up. what do I do?</strong></p>

<h4 id="determine-the-system-bottleneck">Determine the system bottleneck</h4>

<ul>
  <li>Is the issue high CPU?</li>
  <li>Is it IO capacity?</li>
  <li>Is it growing lag without a clear query culprit?</li>
  <li>Is is locks?</li>
  <li>How do I know which it is?</li>
</ul>

<h4 id="you-need-a-baseline">You need a baseline</h4>
<p>Once you know what system metric you are mostly bound to, you need to establish baseline and peak values. Otherwise, determining whether your current issue is a bug vs real growth is going to be a lot more error prone than you‚Äôd like.</p>

<p>Basic server metrics can only go so far but at some point you will find you also need context based metrics. Query performance and app side perceived performance will tell you what the application sees as a response time to queries.</p>

<h4 id="learn-your-business-traffic-patterns">Learn your business traffic patterns</h4>
<p>Are you a business that is susceptible to peaks in specific weekdays (marketing)? do you have regular launches that triple or quadruple your traffic like gaming? These sorts of questions will drive how much of reserved headroom you should keep or whether you need to invest in elastic growth.</p>

<h4 id="determine-the-ratio-of-raw-traffic-numbers-in-relation-to-capacity-in-use">Determine the ratio of raw traffic numbers in relation to capacity in use</h4>
<p>This is simply the answer to ‚ÄúIf we made no code optimizations, how many emails/sales/whatever‚Äù can we serve with the database instance we have right now?</p>

<p>Ideally, this a specific value that makes the math towards planning a year‚Äôs growth a simple math equation. But life is never ideal and this value will vary depending on season or completely external happy factors like signing up a new major customer. In early startups this number is a faster moving target but it should stabilize as the company transitions from early days to more established business with more predictable business growth patterns.</p>

<h4 id="do-i-really-need-to-buy-more-machines">Do I really need to buy more machines?</h4>
<p>You need to find a way to determine if this is truly capacity (I need to split the writes to support more concurrent write load or add more read replicas) vs code based performance bottleneck (this new query can really have its results cached in something cheaper and not beat the database as much).</p>

<p>How do you do that? You need to get familiar with your queries. The baby step for that is a combination of <a href="http://innotop.googlecode.com/svn/html/manual.html">innotop</a>, slow log and the <a href="https://www.percona.com/software/mysql-tools/percona-toolkit">percona toolkit</a>‚Äôs pt-query-digest. You can automate this by shipping the DB logs to a central location and automating the digest portion.</p>

<p>But that is also not the entire picture, slow logs are performance intensive if you lower their threshold too much. If you need less selective sampling you will need to detect the entire conversations between the application and the datastore. In open source land you can go as basic as tcpdump or you can use hosted products like datadog, newrelic or vivid cortex.</p>

<h4 id="make-a-call">Make a call</h4>
<p>Capacity planning can be 90% science and 10% art but that 10% shouldn‚Äôt mean that we shouldn‚Äôt strive for as much of the picture as we can. As engineers we can sometimes fixate on the missing 10% and not realize that if we did the work, that 90% can get us v far into a better idea of our stack‚Äôs health, a more efficient use of our time optimizing performance and planning capacity increases carefully which eventually results in much better return on investment for our products.</p>

      <footer class="entry-meta">
        <span class="entry-tags"><a href="http://localhost:4000/tags#dba101" title="Pages tagged dba101" class="tag"><span class="term">dba101</span></a><a href="http://localhost:4000/tags#capacity" title="Pages tagged capacity" class="tag"><span class="term">capacity</span></a><a href="http://localhost:4000/tags#planning" title="Pages tagged planning" class="tag"><span class="term">planning</span></a></span>
        
        <span class="author vcard"><span class="fn">Silvia Botros</span></span>
        <div class="social-share">
  <ul class="socialcount socialcount-small inline-list">
    <li class="facebook"><a href="https://www.facebook.com/sharer/sharer.php?u=http://localhost:4000/capacity-planning-databases/" title="Share on Facebook"><span class="count"><i class="fa fa-facebook-square"></i> Like</span></a></li>
    <li class="twitter"><a href="https://twitter.com/intent/tweet?text=http://localhost:4000/capacity-planning-databases/" title="Share on Twitter"><span class="count"><i class="fa fa-twitter-square"></i> Tweet</span></a></li>
    <li class="googleplus"><a href="https://plus.google.com/share?url=http://localhost:4000/capacity-planning-databases/" title="Share on Google Plus"><span class="count"><i class="fa fa-google-plus-square"></i> +1</span></a></li>
  </ul>
</div><!-- /.social-share -->

      </footer>
    </div><!-- /.entry-content -->
    <div class="read-more">
  <div class="read-more-header">
    <a href="https://dbsmasher.com" class="read-more-btn">About the Author</a>
  </div><!-- /.read-more-header -->
  <div class="read-more-content author-info">
    <h3>Silvia Botros</h3>
    <div class="author-container">
      <img class="author-img" src="http://localhost:4000/images/avatar.jpg" alt="Silvia Botros" />
      <div class="author-bio">Silvia is a Principal DBA at SendGrid and a mother of three active junior DBAs.</div>
    </div>
    <div class="author-share">
      <ul class="list-inline social-buttons">
        
          <li><a href="https://github.com/silviabotros" target="_blank"><i class="fa fa-github fa-fw"></i></a></li>
        
          <li><a href="http://www.linkedin.com/in/silviabotros" target="_blank"><i class="fa fa-linkedin fa-fw"></i></a></li>
        
      </ul>
      
        <a aria-label="Follow @silviabotros on GitHub" data-style="mega" href="https://github.com/silviabotros" class="github-button">Follow @silviabotros</a>
      
      <br>
      
        <a href="https://twitter.com/dbsmasher" class="twitter-follow-button" data-show-count="false" data-size="large">Follow @dbsmasher</a>
      
    </div>
  </div>
</div>

    
    <div class="read-more">
  
    <div class="read-more-header">
      <a href="http://localhost:4000/2015-review/" class="read-more-btn">Read More</a>
    </div><!-- /.read-more-header -->
    <div class="read-more-content">
      <h3><a href="http://localhost:4000/2017-in-review/" title="2017 in review">2017 in review</a></h3>
      <p>In some ways it feels like this year flew by, in others like it was as long as an eternity. Looking back, it definitely surprises even _m...&hellip; <a href="http://localhost:4000/2017-in-review/">Continue reading</a></p>
    </div><!-- /.read-more-content -->
  
  <div class="read-more-list">
    
      <div class="list-item">
        <h4><a href="http://localhost:4000/on-leadership-vs-management/" title="On leadership vs management">On leadership vs management</a></h4>
        <span>Published on September 30, 2017</span>
      </div><!-- /.list-item -->
    
      <div class="list-item">
        <h4><a href="http://localhost:4000/untitled-chef-audit-mode/" title="Chef audit mode">Chef audit mode</a></h4>
        <span>Published on May 07, 2017</span>
      </div><!-- /.list-item -->
    
  </div><!-- /.read-more-list -->
</div><!-- /.read-more -->
  </article>
</div><!-- /#main -->

<script type="text/javascript" src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
<script type="text/javascript">window.jQuery || document.write('<script type="text/javascript" src="http://localhost:4000/assets/js/vendor/jquery-1.9.1.min.js"><\/script>')</script>
<script type="text/javascript" src="http://localhost:4000/assets/js/scripts.min.js"></script>
<script type="text/javascript" async defer id="github-bjs" src="https://buttons.github.io/buttons.js"></script>
<script type="text/javascript">!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>








<script type="text/javascript">
    sharing();
</script>



<div class="footer-wrapper">
  <footer role="contentinfo">
    <span>&copy; 2018 Silvia Botros. Powered by <a href="http://jekyllrb.com" rel="nofollow">Jekyll</a> using the <a href="http://github.com/aron-bordin/neo-hpstr-jekyll-theme" rel="nofollow">Neo-HPSTR Theme</a>.</span>

  </footer>
</div><!-- /.footer-wrapper -->

</body>
</html>
